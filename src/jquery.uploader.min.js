void 0!==typeof jQuery&&function(d){d.fn.imageUploader=function(k){function u(b){if(d(b.target)[0]===a.dropZone[0])return a.onDragLeave(b)}function v(b){if(d(b.target)[0]===a.dropZone[0])return a.onDragEnter(b)}function w(b){b.preventDefault();b.stopPropagation();return a.onDragStart(b)}function x(b){b.preventDefault();b.stopPropagation();return a.onDragEnd(b)}function y(b){b.preventDefault();b.stopPropagation();return a.onDragOver(b)}function z(b){b.preventDefault();b.stopPropagation();n(b.originalEvent.dataTransfer.files);
return a.onDrop(b)}function s(b){a.thumbnails&&(e=a.thumbnails.div.find('[data-upload-status="waiting"]:first'),e.attr("data-upload-status","uploading"),e.append(d('<div class="progress" />').append(d("<div />"))))}function A(b){b.lengthComputable&&(e&&0!=e.length||s(),e&&e.find(".progress > div").width(100*b.loaded/b.total+"%"));return a.onUploadProgress(b)}function B(b){l=!0;if(200==this.status){var c=null;e&&(e.find(".progress > div").width("100%"),c=e,e=null);a.afterUpload(b.target.response,c);
m()}else p()}function p(){l=!0;e.remove();e=null;a.error("upload failed");m()}function C(){l=!0;e=null;a.error("upload canceled");m()}function D(a){q.push(a);r.push(a);m()}function E(a){for(i in q)if(f=q[i],a.name==f.name&&a.size==f.size&&a.type==f.type)return!0;return!1}function m(){if(l&&0<r.length){file=r.shift();l=!1;var b=file;if(h.upload&&a.beforeUpload()){h.open("POST",a.url);if(b instanceof File){var c=new FormData;c.append("file",b)}else h.setRequestHeader("Content-type","application/x-www-form-urlencoded"),
c="url="+b.name;h.upload.addEventListener("progress",A,!1);h.addEventListener("loadstart",s,!1);h.addEventListener("load",B,!1);h.addEventListener("error",p,!1);h.addEventListener("abort",C,!1);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.send(c)}}}function F(b){b.preventDefault();b.stopPropagation();n(b.target.files);return a.onFilesSelected()}function G(b){(b=b.target.value)&&n([{name:b}]);return a.onUrlSelected()}function n(b){if(window.File&&window.FileReader&&window.FileList&&window.FormData)for(var c=
null,g=0;g<b.length;g++){a.onFileAdded(b[g]);if(0<a.maxFileSize&&file.size>a.maxFileSize)return a.error("the file you are trying to upload is too big");if(!a.allowDuplicate&&E(b[g]))return a.error("the file you are trying to upload has already been sent");if(a.thumbnails||a.thumbnailReady!=d.noop)console.log(b[g],typeof b[g]),b[g]instanceof File?(a.thumbnails.div.file=b[g],c=new FileReader,c.onload=function(a){t(a.target.result)},c.readAsDataURL(b[g])):t(b[g].name);try{D(b[g])}catch(e){p()}}else alert("files api not supported")}
function t(b){var c=new Image;c.src=b;d(c).hide();var g=d("<div />").attr("data-upload-status","waiting").css({overflow:"hidden",position:"relative"}).append(c);c.onload=function(){var b=a.thumbnails.width,e=a.thumbnails.height,k=c.width/c.height;a.thumbnails.crop&&0<b&&0<e?(g.width(b),g.height(e),d(c).css("position","absolute"),b/e>k?"zoom"==a.thumbnails.crop?(c.width=b,c.height=b/k,d(c).css("top","-"+parseInt((c.height-e)/2)+"px")):(c.width=e*k,c.height=e,d(c).css("left",parseInt((b-c.width)/2)+
"px")):"zoom"==a.thumbnails.crop?(c.height=e,c.width=e*k,d(c).css("left","-"+parseInt((c.width-b)/2)+"px")):(c.width=b,c.height=e/k,d(c).css("top",parseInt((e-c.height)/2)+"px"))):(0<b?c.width=b:0<e&&(c.width=e*k),0<e?c.height=e:0<b&&(c.height=b/k));d(c).css({width:c.width,height:c.height});d(c).show("slow")};a.thumbnailReady!=d.noop?a.thumbnailReady(g):a.thumbnails.div.append(g)}var a=d.extend({},d.fn.imageUploader.defaults,k);a.dropZone=d(this);var l=!0,r=[],q=[],e=null,h=new XMLHttpRequest;null!=
a.dropZone&&(a.dropZone.on("dragstart",w),a.dropZone.on("dragend",x),a.dropZone.on("dragleave",u),a.dropZone.on("dragenter",v),a.dropZone.on("dragover",y),a.dropZone.on("drop",z));null!=a.fileField&&(a.dropZone.on("click",function(){a.fileField.trigger("click")}),"string"==typeof a.fileField&&(a.fileField=d(a.fileField)),a.fileField.on("change",F),!0==a.hideFileField&&a.fileField.hide());null!=a.urlField&&("string"==typeof a.urlField&&(a.urlField=d(a.urlField)),a.urlField.on("change",G),!0==a.hideUrlField&&
a.urlField.hide());(function(){if(a.thumbnails){if("object"!=typeof a.thumbnails){var b=null;"string"==typeof a.thumbnails&&(b=d(a.thumbnails));a.thumbnails={div:b,width:null,height:null}}"string"==typeof a.thumbnails.div&&(a.thumbnails.div=d(a.thumbnails.div));"object"==typeof a.thumbnails&&void 0==a.thumbnails.div&&(a.thumbnails.div=null);null==a.thumbnails.div&&(a.thumbnails.div=d('<div class="fileUploadThumbnails" />'),a.dropZone.after(a.thumbnails.div))}})();return this};d.fn.imageUploader.defaults=
{fileField:null,urlField:null,hideFileField:!0,hideUrlField:!0,url:null,thumbnails:{div:null,width:null,height:null},maxFileSize:0,allowDuplicate:!1,thumbnailReady:d.noop,onFileAdded:function(d){return!1},onFilesSelected:function(){return!1},onUrlSelected:function(){return!1},onDragStart:function(d){return!1},onDragEnd:function(d){return!1},onDragEnter:function(d){return!1},onDragLeave:function(d){return!1},onDragOver:function(d){return!1},onDrop:function(d){return!1},onUploadProgress:function(d){return!1},
beforeUpload:function(){return!0},afterUpload:function(){return!1},error:function(d){alert(d)},debug:!1}}(jQuery);